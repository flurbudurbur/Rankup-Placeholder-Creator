<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rankup Placeholder Creator</title>
    <link rel="stylesheet" href="./css/tailwind-compiled.css">
    <script>
      // wait for window to load
      window.addEventListener("load", () => {
        // get the selectors
        const requirementSelector = document.getElementById(
          "requirementSelector"
        );
        const formatterSelector = document.getElementById("formatterSelector");
        const filterSelector = document.getElementById("filterSelector");
        const output = document.getElementById("output");
        const completionSlider = document.getElementById("completion");
        const ingameOutput = document.getElementById("ingameOutput");
        const subRequirementDiv = document.getElementById("subRequirementDiv");
        const subRequirementInput = document.getElementById(
          "subRequirementInput"
        );

        // add event listeners
        requirementSelector.addEventListener("change", () => {
          updateOutput();
        });
        formatterSelector.addEventListener("change", () => {
          updateOutput();
        });
        filterSelector.addEventListener("change", () => {
          updateOutput();
        });
        completionSlider.addEventListener("input", () => {
          updateOutput();
        });
        subRequirementInput.addEventListener("input", () => {
          updateOutput();
        });

        var ingameTotal = 0;
        var ingameFilter = "";

        // update the output
        function updateOutput() {
          // get the values
          const requirement = requirementSelector.value || "money";
          const formatter = formatterSelector.value || "total";
          const filter = filterSelector.value || "simple";

          // get the data-subReq attribute value
          const subReq =
            requirementSelector.options[
              requirementSelector.selectedIndex
            ].getAttribute("data-subReq");

          var subRequirement = "";

          if (subReq == "true") {
            subRequirementDiv.style.display = "grid";
            var subRequirement = ", '" + subRequirementInput.value + "'";
            var subRequirement = subRequirement.replace(/%/g, "");
          } else {
            subRequirementDiv.style.display = "none";
            var subRequirement = "";
          }

          switch (formatter) {
            case "total":
              var ingameTotal = completionSlider.max;
              break;
            case "done":
              if (completionSlider.value == completionSlider.max) {
                var ingameTotal = 1;
              } else {
                var ingameTotal = 0;
              }
              break;
            case "progress":
              var ingameTotal = completionSlider.value;
              break;
            case "remaining":
              var ingameTotal = completionSlider.max - completionSlider.value;
              break;
            case "quotient":
              var ingameTotal = completionSlider.value / completionSlider.max;
              break;
            case "percent":
              var ingameTotal =
                (completionSlider.value / completionSlider.max) * 100;
              break;
            default:
              var ingameTotal = completionSlider.value;
              break;
          }

          switch (filter) {
            case "none":
              var ingameTotal = Number(ingameTotal).toFixed(1);
              break;
            case "money":
              var ingameTotal = Number(ingameTotal)
                .toFixed(2)
                .toString()
                .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              break;
            case "percent":
              var ingameTotal = Number(ingameTotal).toFixed(1);
              break;
            case "simple":
              var ingameTotal = Math.round(ingameTotal);
              break;
            case "shortmoney":
              const shortMoneyArray = [
                "K",
                "M",
                "B",
                "T",
                "Q",
                "Qu",
                "S",
                "Se",
                "O",
                "N",
                "D",
              ];
              for (var i = 1; i < 15; i++) {
                if (ingameTotal >= Math.pow(10, 3 * i)) {
                  var ingameTotal =
                    (ingameTotal / Math.pow(10, 3 * i)).toFixed(0) +
                    shortMoneyArray[i - 1];
                }
              }
              break;

            default:
              var ingameTotal = Math.round(ingameTotal);
              break;
          }

          // update the output
          output.innerHTML = `{{ rank.req('${requirement}'${subRequirement}).${formatter} | ${filter} }}`;
          ingameOutput.innerHTML = ingameTotal;
        }

        
        updateOutput();
      });
      function copyToClipboard() {
        var copyText = document.getElementById("output");
        var button = document.getElementById("copyButton");
        navigator.clipboard.writeText(copyText.innerHTML);
        button.innerHTML = "Copied!";
        setTimeout(() => {
          button.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none">
              <path d="M20.9983 10C20.9862 7.82497 20.8897 6.64706 20.1213 5.87868C19.2426 5 17.8284 5 15 5H12C9.17157 5 7.75736 5 6.87868 5.87868C6 6.75736 6 8.17157 6 11V16C6 18.8284 6 20.2426 6.87868 21.1213C7.75736 22 9.17157 22 12 22H15C17.8284 22 19.2426 22 20.1213 21.1213C21 20.2426 21 18.8284 21 16V15" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M3 10V16C3 17.6569 4.34315 19 6 19M18 5C18 3.34315 16.6569 2 15 2H11C7.22876 2 5.34315 2 4.17157 3.17157C3.51839 3.82475 3.22937 4.69989 3.10149 6" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"/>
              </svg>`;
        }, 500);
      }
    </script>
  </head>
  <body class="font-mono">
    <h1 class="text-4xl font-bold px-10 py-6 text-center bg-gray-300">
      Rankup Placeholder Creator
    </h1>
    <div class="flex p-6 gap-4 bg-gray-200">
      <div class="p-4 grid grid-cols-1 gap-2 w-2/5">
        <h2 class="text-3xl text-center font-bold">Variables</h2>
        <div class="grid grid-cols-2 border-black border-b-2">
          <label class="" for="requirement">Requirement</label>
          <select name="requirement" id="requirementSelector">
            <option selected value="money" data-subReq="false">
              <code>money</code>
            </option>
            <option value="xp-level" data-subReq="false">
              <code>xp-level</code>
            </option>
            <option value="mob-kills" data-subReq="true">
              <code>mob-kills</code>
            </option>
          </select>
        </div>
        <div
          id="subRequirementDiv"
          style="display: grid"
          class="grid grid-cols-2 border-black border-b-2"
        >
          <label for="subRequirementInput">Sub-requirement</label>
          <input
            type="text"
            name="subRequirementInput"
            id="subRequirementInput"
            placeholder="sub requirement"
          />
        </div>
        <div class="grid grid-cols-2 border-black border-b-2">
          <label for="requirementValue">formatter</label>
          <select name="formatter" id="formatterSelector">
            <option value="done"><code>done</code></option>
            <option selected value="total"><code>total</code></option>
            <option value="progress"><code>progress</code></option>
            <option value="remaining"><code>remaining</code></option>
            <option value="quotient"><code>quotient</code></option>
            <option value="percent"><code>percent</code></option>
          </select>
        </div>
        <div class="grid grid-cols-2 border-black border-b-2">
          <label for="filter">Filter</label>
          <select name="filter" id="filterSelector">
            <option selected value="simple">simple (recommended)</option>
            <option value="money">money</option>
            <option value="percent">percent</option>
            <option value="shortmoney">shortmoney</option>
            <option value="none">none</option>
          </select>
        </div>
      </div>
      <div class="flex flex-col w-full">
        <div class="flex gap-4">
          <div class="flex flex-col w-full relative">
            <h3 class="text-2xl font-bold">Placeholder</h3>
            <code class="bg-gray-600 text-white rounded-md p-3 select-all" id="output">{{ rank.req('money').total | simple }}</code>
            <button class="absolute right-3 text-white top-10" id="copyButton" onclick="copyToClipboard()" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none">
              <path d="M20.9983 10C20.9862 7.82497 20.8897 6.64706 20.1213 5.87868C19.2426 5 17.8284 5 15 5H12C9.17157 5 7.75736 5 6.87868 5.87868C6 6.75736 6 8.17157 6 11V16C6 18.8284 6 20.2426 6.87868 21.1213C7.75736 22 9.17157 22 12 22H15C17.8284 22 19.2426 22 20.1213 21.1213C21 20.2426 21 18.8284 21 16V15" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M3 10V16C3 17.6569 4.34315 19 6 19M18 5C18 3.34315 16.6569 2 15 2H11C7.22876 2 5.34315 2 4.17157 3.17157C3.51839 3.82475 3.22937 4.69989 3.10149 6" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"/>
              </svg><button>
          </div>
          <div class="flex flex-col w-1/3">
            <h3 class="text-2xl font-bold">Ingame output</h3>
            <code class="bg-gray-600 text-white rounded-md p-3" id="ingameOutput">10000</code>
          </div>
        </div>
        <div class="flex flex-col my-6">
          <label for="completion">Simulate Requirement Completion</label>
          <input
            type="range"
            name="completion"
            id="completion"
            min="0"
            step="0.5"
            max="10000"
            value="5000"
          />
        </div>
      </div>
    </div>
  </body>
</html>
